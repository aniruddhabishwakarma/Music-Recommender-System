{% extends "music/base.html" %}
{% load static %}
{% block title %}{{ artist.name }}{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 py-10 text-white">

  <!-- Artist Info -->
  <div class="flex items-center gap-6 mb-10">
    <img src="{{ artist.picture_url }}" alt="{{ artist.name }}" class="w-32 h-32 rounded-full object-cover border-4 border-blue-500 shadow-lg">
    <div>
      <h2 class="text-3xl font-bold text-white">{{ artist.name }}</h2>
      <p class="text-gray-400">👥 Fans: {{ artist.fans_count }}</p>
      <a href="{{ artist.link }}" target="_blank" class="text-blue-400 hover:underline text-sm">Visit Official Page</a>
      <br><br>
      <button class="bg-blue-600 px-4 py-2 rounded text-white font-semibold hover:bg-blue-700">+ Follow</button>
    </div>
  </div>

  <!-- Songs Section -->
  <div class="mb-10">
    <h3 class="text-2xl font-semibold text-blue-400 mb-4">🎵 Songs</h3>
    <div class="bg-[#1e2538] rounded-lg max-h-96 overflow-y-auto custom-scroll divide-y divide-gray-700">
      {% for song in songs %}
        <div class="grid grid-cols-12 items-center px-4 py-3">
          <!-- Cover + Title -->
          <div class="col-span-6 flex items-center gap-4">
            <img src="{{ song.album.cover_url|default:'/static/images/images.png' }}" alt="{{ song.title }}" class="w-12 h-12 rounded-md object-cover">
            <span class="text-white font-medium">{{ song.title }}</span>
          </div>
          <!-- Duration -->
          <div class="col-span-3 text-center text-gray-400 text-sm">
            {% if song.duration %}
              {{ song.minutes }}m {{ song.seconds }}s
            {% else %}
              N/A
            {% endif %}
          </div>
          <!-- Like Button -->
          <div class="col-span-3 text-right">
            <button class="text-red-500 hover:text-red-400 text-xl">❤️</button>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- Albums Section -->
  <div>
    <h3 class="text-2xl font-semibold text-purple-400 mb-4">💿 Albums</h3>
    <div class="grid md:grid-cols-3 gap-6">
      {% for album in albums %}
        <div 
          class="album-card bg-[#1e2538] rounded-lg shadow-md overflow-hidden cursor-pointer" 
          data-title="{{ album.title|escapejs }}" 
          data-cover="{{ album.cover_url }}" 
          data-songs='{{ album.songs_data|safe|escapejs }}'
        >
          <img src="{{ album.cover_url }}" alt="{{ album.title }}" class="w-full h-40 object-cover">
          <div class="p-4">
            <h4 class="text-white font-bold">{{ album.title }}</h4>
            <p class="text-gray-400 text-sm">📅 Released: {{ album.release_date }}</p>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- Album Modal -->
  <div id="album-modal" class="fixed inset-0 z-50 bg-black bg-opacity-70 hidden flex items-center justify-center">
    <div class="bg-[#1e2538] w-4/5 max-w-3xl p-6 rounded-lg shadow-lg text-white relative">
      <button class="absolute top-2 right-3 text-3xl hover:text-red-500" onclick="closeAlbumModal()">&times;</button>
      <div class="flex gap-6 items-center mb-6">
        <img id="modal-album-cover" src="" alt="Album Cover" class="w-32 h-32 rounded-md object-cover">
        <h3 id="modal-album-title" class="text-2xl font-bold">Album Title</h3>
      </div>
      <div id="modal-album-songs" class="space-y-4 max-h-60 overflow-y-auto custom-scroll"></div>
    </div>
  </div>

</div>

<script>
  function openAlbumModal(title, cover, songs) {
    document.getElementById("modal-album-title").innerText = title;
    document.getElementById("modal-album-cover").src = cover;

    const songsContainer = document.getElementById("modal-album-songs");
    songsContainer.innerHTML = "";

    songs.forEach(song => {
      const div = document.createElement("div");
      div.className = "flex justify-between items-center bg-gray-700 p-3 rounded";
      div.innerHTML = `
        <span class="text-white">🎵 ${song.title}</span>
        <span class="text-sm text-gray-300">${Math.floor(song.duration / 60)}m ${song.duration % 60}s</span>
      `;
      songsContainer.appendChild(div);
    });

    document.getElementById("album-modal").classList.remove("hidden");
  }

  function closeAlbumModal() {
    document.getElementById("album-modal").classList.add("hidden");
  }

  // Attach click listeners to each album card
  document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".album-card").forEach(card => {
    card.addEventListener("click", () => {
      const albumId = card.dataset.id;

      fetch(`/album/${albumId}/json/`)
        .then(res => res.json())
        .then(data => {
          openAlbumModal(data.title, data.cover, data.songs);
        })
        .catch(err => {
          console.error("❌ Failed to fetch album songs:", err);
        });
    });
  });
});
</script>

{% endblock %}
