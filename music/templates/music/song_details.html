<!-- ‚úÖ Fixed Song Details Modal -->
<div id="song-modal" class="fixed inset-0 pt-20 flex items-center justify-center bg-opacity-50 z-50 hidden">
    <div class="text-white p-6 translate-x-18 translate-y-3 bg-[#111827] rounded-lg shadow-lg w-3/5 h-4/5 overflow-y-auto custom-scroll">

        <!-- ‚úÖ Close Button -->
        <button class="absolute top-4 right-4 text-gray-400 hover:text-red-500 text-3xl font-bold transition-transform transform hover:scale-125"
                onclick="closeModal()">
            ‚úñ
        </button>

        <!-- ‚úÖ Song Details Section -->
        <div class="flex flex-col md:flex-row items-center">
            <!-- ‚úÖ Album Cover & Album Details -->
            {% load static %}
            <div class="flex flex-col items-center w-full md:w-1/3">
                <img id="modal-album-cover" src="{% static 'images/images.png' %}"
                     onerror="this.onerror=null;this.src='/static/images/images.png';"
                     alt="Album Cover" class="w-64 h-64 object-cover rounded-lg shadow-lg">
                <p class="text-gray-400 text-lg mt-2">
                    üí∞ <span class="font-semibold">Album:</span> <span id="modal-album">N/A</span>
                </p>
                <p class="text-gray-300 text-md">
                    üìÖ <span class="font-semibold">Released:</span> <span id="modal-release-date">Unknown</span>
                </p>
            </div>

            <!-- ‚úÖ Song Information -->
            <div class="flex flex-col justify-center w-full md:w-2/3 px-6">
                <!-- ‚úÖ Title & Artist -->
                <h2 id="modal-title" class="text-3xl font-bold text-center md:text-left">Song Title</h2>

                <!-- ‚úÖ Artist Info -->
                <div class="flex items-center mt-2">
                    <img id="modal-artist-photo" src="{% static 'images/default_artist.jpg' %}"
                         onerror="this.onerror=null;this.src='/static/images/default_artist.jpg';"
                         alt="Artist Photo" class="w-14 h-14 rounded-full shadow-md">
                    <div class="ml-3">
                        <a id="modal-artist-link" href="#" class="text-blue-400 text-lg hover:underline">
                            <span id="modal-artist">Unknown Artist</span>
                        </a>
                        <p class="text-gray-400 text-sm">üë• Fans: <span id="modal-artist-fans">0</span></p>
                    </div>
                </div>

                <!-- ‚úÖ Duration -->
                <p class="text-gray-300 text-md mt-4">
                    ‚è≥ <span class="font-semibold">Duration:</span> 
                    <span id="modal-duration">0m 0s</span>
                </p>

                <!-- ‚úÖ Like & Play Preview Buttons -->
                <div class="flex space-x-4 mt-4">
                    <button class="bg-gray-700 hover:bg-red-500 text-white font-bold py-2 px-6 rounded-lg shadow-lg">
                        ‚ù§Ô∏è Like
                    </button>
                    <a id="modal-playback-btn" href="#" target="_blank">
                        <button class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg shadow-lg">
                            ‚ñ∂Ô∏è Play Preview
                        </button>
                    </a>
                </div>
            </div>
        </div>

        <!-- ‚úÖ Reviews Section (Scrollable) -->
        <div class="mt-8">
            <h3 class="text-xl font-bold mb-4">üì¢ User Reviews</h3>
            <div id="review-list" class="overflow-y-auto max-h-40 custom-scroll">
                <p class="text-gray-500 text-sm italic">No reviews yet. Be the first to review! üé∂</p>
            </div>
            <div class="mt-6">
                <textarea id="review-input" class="w-full p-3 bg-gray-800 text-gray-300 rounded-lg" placeholder="Write your review..."></textarea>
                <button onclick="submitReview()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg shadow-lg mt-2">
                    Submit Review
                </button>
            </div>
        </div>
    </div>
</div>

<script>
function openModal(songId) {
    fetch(`/api/song/${songId}/`)
        .then(response => response.json())
        .then(song => {
            const minutes = Math.floor(song.duration / 60);
            const seconds = song.duration % 60;

            document.getElementById("modal-title").innerText = song.title;
            document.getElementById("modal-artist").innerText = song.artist.name;
            document.getElementById("modal-artist-link").href = `/artist/${song.artist.id}/`;
            document.getElementById("modal-artist-photo").src = song.artist.picture_url || "/static/images/default_artist.jpg";
            document.getElementById("modal-artist-fans").innerText = song.artist.fans_count;
            document.getElementById("modal-album-cover").src = song.album.cover_url || "/static/images/images.png";
            document.getElementById("modal-album").innerText = song.album.title;
            document.getElementById("modal-release-date").innerText = song.album.release_date;
            document.getElementById("modal-duration").innerText = `${minutes}m ${seconds}s`;
            document.getElementById("modal-playback-btn").href = song.preview_url || "#";
            document.getElementById("song-modal").classList.remove("hidden");
        })
        .catch(error => console.error("‚ùå Error fetching song details:", error));
}

function submitReview() {
    let reviewText = document.getElementById("review-input").value.trim();
    let reviewList = document.getElementById("review-list");

    if (reviewText) {
        let reviewItem = document.createElement("div");
        reviewItem.className = "bg-gray-800 p-4 rounded-lg shadow-md mt-3";
        reviewItem.innerHTML = `<p class="text-gray-300">üî• "${reviewText}" - Anonymous</p>`;
        reviewList.appendChild(reviewItem);
        document.getElementById("review-input").value = "";
    }
}

function closeModal() {
    document.getElementById("song-modal").classList.add("hidden");
}
</script>

<style>
.custom-scroll::-webkit-scrollbar {
    width: 10px;
}
.custom-scroll::-webkit-scrollbar-track {
    background: #1F2937;
    border-radius: 10px;
}
.custom-scroll::-webkit-scrollbar-thumb {
    background: #4B5563;
    border-radius: 10px;
    border: 3px solid #1F2937;
}
.custom-scroll::-webkit-scrollbar-thumb:hover {
    background: #6B7280;
}
@keyframes slide-in {
  from {
    opacity: 0;
    transform: translateX(100%);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}
.animate-slide-in {
  animation: slide-in 0.4s ease-out;
}
</style>
